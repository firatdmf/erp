{% comment %} {% extends 'base.html' %} {% endcomment %}
{% load static %}
{% load accounting_tags %}
{% block css %}
<style>
  .kpi-container {
    display: flex;
    gap: 2rem;
    flex-wrap: wrap;
  }

  .kpi-summary {
    flex: 0 0 300px;
    min-width: 250px;
    padding-right: 2rem;
    border-right: 1px solid var(--border-color, #e5e7eb);
  }

  .kpi-table-container {
    flex: 1;
    min-width: 400px;
    overflow-x: auto;
  }

  .kpi-label {
    font-size: 0.8rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: #64748b;
    margin-bottom: 0.5rem;
    font-weight: 600;
  }

  .total-balance {
    font-size: 2.5rem;
    font-weight: 700;
    color: #10b981;
    margin-bottom: 0.25rem;
  }

  .balance-currency {
    font-size: 1rem;
    font-weight: 400;
    color: #94a3b8;
  }

  .runway-val {
    font-size: 1.5rem;
    font-weight: 600;
    color: #1e293b;
  }

  .runway-unit {
    font-size: 0.9rem;
    font-weight: 400;
    color: #64748b;
  }

  /* Custom Table */
  .kpi-table {
    width: 100%;
    border-collapse: separate;
    border-spacing: 0;
    font-size: 0.9rem;
  }

  .kpi-table th {
    text-align: left;
    color: #94a3b8;
    font-weight: 600;
    text-transform: uppercase;
    font-size: 0.75rem;
    padding: 0.75rem 1rem;
    border-bottom: 1px solid #f1f5f9;
  }

  .kpi-table td {
    padding: 1rem;
    color: #334155;
    border-bottom: 1px solid #f1f5f9;
    white-space: nowrap;
  }

  .kpi-table tr:last-child td {
    border-bottom: none;
  }

  .text-green {
    color: #10b981;
  }

  .text-red {
    color: #ef4444;
  }

  .status-badge {
    display: inline-flex;
    align-items: center;
    gap: 0.35rem;
    padding: 0.25rem 0.75rem;
    border-radius: 999px;
    font-size: 0.8rem;
    font-weight: 500;
  }

  .status-badge.yes {
    background: #dcfce7;
    color: #166534;
  }

  .status-badge.no {
    background: #fee2e2;
    color: #991b1b;
  }

  @media (max-width: 900px) {
    .kpi-container {
      flex-direction: column;
      gap: 1.5rem;
    }

    .kpi-summary {
      border-right: none;
      padding-right: 0;
      border-bottom: 1px solid #e5e7eb;
      padding-bottom: 1.5rem;
      flex: auto;
    }
  }
</style>
{% endblock %}

{% block content %}
<div class="kpi-container">
  <!-- Left: Summary -->
  <div class="kpi-summary">
    <div class="mb-4">
      <div class="kpi-label">ACCOUNTING KPIS</div>
      <div class="balance-currency">Total Balance ({{ base_currency }})</div>
      <div class="total-balance">{{base_currency.symbol}}{{ total_balance|format_money }}</div>
    </div>

    <div class="mt-4">
      <div class="balance-currency">Base runway</div>
      <div class="runway-val">
        {{base_runway|floatformat:2}} <span class="runway-unit">months</span>
      </div>
    </div>
  </div>

  <!-- Right: Table -->
  <div class="kpi-table-container">
    <div class="kpi-label mb-2">Per-Currency Breakdown</div>
    <table class="kpi-table">
      <thead>
        <tr>
          <th>CURRENCY</th>
          <th>BALANCE</th>
          <th>MONEY IN</th>
          <th>MONEY OUT</th>
          <th>RUNWAY</th>
          <th>DEFAULT ALIVE?</th>
        </tr>
      </thead>
      <tbody>
        {% for kpi in currency_kpis %}
        <tr>
          <td style="font-weight: 600;">{{ kpi.currency.code }}</td>
          <td>{{kpi.currency.symbol}}{{ kpi.balance|format_money }}</td>
          <td class="text-green">{{kpi.currency.symbol}}{{ kpi.money_in|format_money }}</td>
          <td class="text-red">{{kpi.currency.symbol}}{{ kpi.money_out|format_money }}</td>
          <td>
            {% if kpi.runway %}{{ kpi.runway }}{% else %}-{% endif %}
          </td>
          <td>
            {% if kpi.default_alive %}
            <span class="status-badge yes"><i class="fas fa-check-circle"></i> Yes</span>
            {% else %}
            <span class="status-badge no"><i class="fas fa-times-circle"></i> No</span>
            {% endif %}
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}