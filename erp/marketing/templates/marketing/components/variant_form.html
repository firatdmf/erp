{% load static %}
{% block css %}
    <link rel="stylesheet" href="{% static 'marketing/css/components/variant_form.css' %}" />
{% endblock css %}

<div class="loading" id="loading">Loading&#8230;</div>

<!-- Initial: Show only Add Variants button -->
<div id="add_variant_trigger" style="margin: 20px 0;">
  <button type="button" class="add_another_option" onclick="showVariantSection()" style="border: 1.5px dashed #667eea;">
    <i class="fa fa-plus"></i> Add Product Variants
  </button>
</div>

<!-- Variant Options Section (initially hidden) -->
<div class="variant_component" id="variant_component" style="display: none;">
    <div class="variant_container" id="variant_container">
      <div class="variantCard" id="variantCard_1">
        <div class="option_name">
          <div>Option Name</div>
          <input type="text" placeholder="e.g. Color, Size" name="variant_name_1" id="variant_name_1">
        </div>
        <div class="optionValues">
          <div>Option Values</div>
          <input type="text" placeholder="e.g. Red" name="variant_name_1_value_1" id="variant_name_1_value_1">
          <input type="text" placeholder="e.g. Blue" name="variant_name_1_value_2" id="variant_name_1_value_2">
          <div class="add_another_value" id="variant_name_1_add_another_value_3" onClick=add_another_value(this)>
            <i class="fa fa-plus"></i> Add Another Option Value
          </div>
          <div id="error_message_option_value_1" class="alert"></div>
        </div>
      </div>
      <div id="add_another_name_2" class="add_another_option" onClick=add_another_name(this)>
        <i class="fa fa-plus"></i> Add Another Option
      </div>
      <div id="error_message_option_name" class="alert"></div>
    </div>

    <div style="margin-top: 20px;">
      <div onClick=createTable() id="create_table_button">
        <i class="fa fa-table"></i> Create Variant Table
      </div>
    </div>

    <table id="variant_table"></table>

  {% comment %} <p>{{message}}</p> {% endcomment %}
  <script>
    // Show variant section when button is clicked
    function showVariantSection() {
      document.getElementById('add_variant_trigger').style.display = 'none';
      document.getElementById('variant_component').style.display = 'block';
    }
    
    // Set window variables FIRST
    window.my_message = "{{ message }}";
    window.product_variant_list_data = '{{ product_variant_list }}';
    window.product_variant_options_data = '{{ product_variant_options }}';
    window.variant_files_json_data = '{{ variant_files_json }}';
    
    // Debug logs
    console.log('Variant form loaded');
    console.log('product_variant_list_data:', window.product_variant_list_data);
    console.log('product_variant_options_data:', window.product_variant_options_data);
    
    // If editing and variants exist, show variant section automatically
    if (window.product_variant_list_data && window.product_variant_list_data !== '[]' && window.product_variant_list_data !== '') {
      console.log('Showing variant section because variants exist');
      showVariantSection();
    }
  </script>

  <script src="{% static 'marketing/js/variant_form.js' %}" defer></script>
</div>