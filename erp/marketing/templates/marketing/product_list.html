{% extends "base.html" %}
{% load static %}
<script src="https://unpkg.com/htmx.org@1.9.10"></script>

{% block css %}
<style>
  /* ============================================
 * Product Catalog - Premium Modern Design
 * ============================================ */

  /* Base & Typography */
  .product-catalog {
    background: #f8fafc;
    min-height: 100vh;
    padding: 32px 40px;
    font-family: 'Inter', system-ui, -apple-system, sans-serif;
    color: #0f172a;
  }

  /* Header Section */
  .catalog-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 24px;
  }

  .catalog-title h1 {
    font-size: 24px;
    font-weight: 700;
    color: #0f172a;
    margin: 0 0 4px 0;
    letter-spacing: -0.5px;
  }

  .catalog-title p {
    font-size: 14px;
    color: #64748b;
    margin: 0;
  }

  .compact-mode {
    display: flex;
    align-items: center;
    gap: 12px;
    background: white;
    padding: 8px 16px;
    border-radius: 20px;
    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
    font-size: 13px;
    font-weight: 500;
    color: #64748b;
  }

  .toggle-switch {
    width: 36px;
    height: 20px;
    background: #e2e8f0;
    border-radius: 10px;
    position: relative;
    cursor: pointer;
    transition: all 0.2s ease;
  }

  .toggle-switch::after {
    content: '';
    position: absolute;
    top: 2px;
    left: 2px;
    width: 16px;
    height: 16px;
    background: white;
    border-radius: 50%;
    transition: all 0.2s ease;
    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  }

  .toggle-switch.active {
    background: #3b82f6;
  }

  .toggle-switch.active::after {
    left: 18px;
  }

  /* Filter Bar */
  .filter-bar {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 24px;
    flex-wrap: wrap;
  }

  .catalog-search-wrapper {
    position: relative;
    flex: 0 0 320px;
  }

  .catalog-search-input {
    width: 100%;
    height: 44px;
    padding: 0 16px 0 44px;
    border: 1px solid #e2e8f0;
    border-radius: 10px;
    background: white;
    font-size: 14px;
    color: #0f172a;
    transition: all 0.2s;
    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
  }

  .catalog-search-input:focus {
    outline: none;
    border-color: #3b82f6;
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
  }

  .catalog-search-icon {
    position: absolute;
    left: 14px;
    top: 50%;
    transform: translateY(-50%);
    color: #94a3b8;
    pointer-events: none;
  }

  .filter-btn {
    height: 44px;
    padding: 0 16px;
    border: 1px solid #e2e8f0;
    border-radius: 10px;
    background: white;
    font-size: 14px;
    font-weight: 500;
    color: #334155;
    display: flex;
    align-items: center;
    gap: 8px;
    cursor: pointer;
    transition: all 0.15s;
    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
  }

  .filter-btn:hover {
    background: #f8fafc;
    border-color: #cbd5e1;
  }

  .filter-btn i {
    color: #64748b;
    font-size: 12px;
  }

  .actions-right {
    margin-left: auto;
    display: flex;
    gap: 12px;
  }

  .btn-primary {
    height: 44px;
    padding: 0 20px;
    background: #3b82f6;
    color: white;
    border: none;
    border-radius: 10px;
    font-size: 14px;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 8px;
    cursor: pointer;
    transition: all 0.2s;
    text-decoration: none;
    box-shadow: 0 2px 4px rgba(59, 130, 246, 0.15);
  }

  .btn-primary:hover {
    background: #2563eb;
    transform: translateY(-1px);
  }

  /* Table Design */
  .table-card {
    background: white;
    border: 1px solid #e2e8f0;
    border-radius: 16px;
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
    overflow: hidden;
  }

  .product-table {
    width: 100%;
    border-collapse: collapse;
  }

  .product-table th {
    background: #f8fafc;
    padding: 16px 20px;
    text-align: left;
    font-size: 11px;
    font-weight: 700;
    color: #64748b;
    text-transform: uppercase;
    letter-spacing: 0.8px;
    border-bottom: 1px solid #e2e8f0;
  }

  .product-table td {
    padding: 16px 20px;
    vertical-align: middle;
    border-bottom: 1px solid #f1f5f9;
    font-size: 14px;
    color: #334155;
  }

  .product-row:hover {
    background: #f8fafc;
  }

  .product-row.expanded {
    background: #eff6ff;
  }

  /* Checkbox */
  .custom-checkbox {
    width: 20px;
    height: 20px;
    border: 2px solid #cbd5e1;
    border-radius: 6px;
    cursor: pointer;
    transition: all 0.15s;
    position: relative;
  }

  .custom-checkbox:hover {
    border-color: #3b82f6;
  }

  /* Image */
  .product-image-box {
    width: 48px;
    height: 48px;
    border-radius: 8px;
    overflow: hidden;
    background: #f1f5f9;
    border: 1px solid #f1f5f9;
  }

  .product-image-box img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .product-image-box.placeholder {
    display: flex;
    align-items: center;
    justify-content: center;
    color: #cbd5e1;
    font-size: 20px;
  }

  /* Product Info */
  .product-name {
    font-size: 14px;
    font-weight: 600;
    color: #0284c7;
    /* Brand Blue */
    text-decoration: none;
    display: block;
    margin-bottom: 3px;
  }

  .product-updated {
    font-size: 12px;
    color: #94a3b8;
  }

  /* SKU Badge */
  .sku-badge {
    font-family: 'JetBrains Mono', monospace;
    font-size: 12px;
    color: #475569;
    background: #f1f5f9;
    padding: 4px 8px;
    border-radius: 6px;
    letter-spacing: -0.5px;
  }

  /* Attributes */
  .attr-tag {
    display: inline-flex;
    padding: 4px 10px;
    background: #f1f5f9;
    color: #475569;
    border-radius: 6px;
    font-size: 12px;
    font-weight: 500;
    border: 1px solid #e2e8f0;
    margin-right: 6px;
  }

  /* Stock */
  .stock-val {
    font-size: 15px;
    font-weight: 700;
    color: #0f172a;
  }

  .stock-status-text {
    font-size: 11px;
    font-weight: 600;
    display: block;
    margin-top: 2px;
  }

  .text-success {
    color: #16a34a;
  }

  .text-warning {
    color: #d97706;
  }

  .text-danger {
    color: #dc2626;
  }

  /* Status Badges */
  .status-pill {
    display: inline-flex;
    padding: 6px 14px;
    border-radius: 999px;
    font-size: 12px;
    font-weight: 600;
  }

  .pill-active {
    background: #dcfce7;
    color: #15803d;
  }

  .pill-low {
    background: #ffedd5;
    color: #c2410c;
  }

  .pill-discontinued {
    background: #f1f5f9;
    color: #64748b;
  }

  .pill-premium {
    background: #e0f2fe;
    color: #0369a1;
  }

  /* Expand Button */
  .btn-expand {
    width: 32px;
    height: 32px;
    border: none;
    background: transparent;
    color: #94a3b8;
    border-radius: 6px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s;
  }

  .btn-expand:hover {
    background: #f1f5f9;
    color: #64748b;
  }

  .expanded .btn-expand {
    transform: rotate(90deg);
    background: #dbeafe;
    color: #3b82f6;
  }

  /* Variant Row */
  .variant-row {
    display: none;
  }

  .variant-row.show {
    display: table-row;
  }

  .variant-box {
    background: #f8fafc;
    padding: 24px 32px 24px 84px;
    border-top: 1px solid #e2e8f0;
    border-bottom: 1px solid #e2e8f0;
    box-shadow: inset 0 4px 6px -4px rgba(0, 0, 0, 0.05);
  }

  .variant-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 16px;
    padding-bottom: 12px;
    border-bottom: 2px solid #e2e8f0;
  }

  .variant-title {
    font-size: 12px;
    font-weight: 700;
    color: #475569;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  .add-variant-link {
    font-size: 12px;
    font-weight: 600;
    color: #3b82f6;
    text-decoration: none;
    display: flex;
    align-items: center;
    gap: 4px;
  }

  .add-variant-link:hover {
    text-decoration: underline;
  }

  .v-table {
    width: 100%;
  }

  .v-table td {
    padding: 12px 16px;
    font-size: 13px;
    color: #334155;
    border-bottom: 1px solid #e2e8f0;
    background: transparent;
  }

  .v-table tr:last-child td {
    border-bottom: none;
  }

  .v-name {
    display: flex;
    align-items: center;
    gap: 12px;
    font-weight: 500;
  }

  .v-dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: #3b82f6;
    box-shadow: 0 0 0 2px #dbeafe;
  }

  /* Modals (Hidden by Default) */
  .modal-backdrop {
    position: fixed;
    inset: 0;
    background: rgba(15, 23, 42, 0.6);
    backdrop-filter: blur(4px);
    z-index: 1000;
    display: none;
    /* Hidden by default */
    align-items: center;
    justify-content: center;
  }

  .modal-backdrop.show {
    display: flex;
  }

  .modal-card {
    background: white;
    width: 100%;
    max-width: 440px;
    border-radius: 16px;
    padding: 32px;
    text-align: center;
    box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
    animation: modalSlide 0.3s cubic-bezier(0.16, 1, 0.3, 1);
  }

  @keyframes modalSlide {
    from {
      transform: translateY(20px);
      opacity: 0;
    }

    to {
      transform: translateY(0);
      opacity: 1;
    }
  }

  .modal-icon {
    width: 56px;
    height: 56px;
    border-radius: 50%;
    margin: 0 auto 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 24px;
  }

  .modal-icon.danger {
    background: #fef2f2;
    color: #dc2626;
  }

  .modal-icon.info {
    background: #eff6ff;
    color: #3b82f6;
  }

  .modal-title {
    font-size: 20px;
    font-weight: 700;
    color: #0f172a;
    margin-bottom: 8px;
  }

  .modal-desc {
    font-size: 14px;
    color: #64748b;
    margin-bottom: 24px;
    line-height: 1.5;
  }

  .modal-actions {
    display: flex;
    gap: 12px;
    justify-content: center;
  }

  .btn-secondary {
    padding: 10px 20px;
    background: white;
    border: 1px solid #cbd5e1;
    color: #475569;
    border-radius: 8px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
  }

  .btn-secondary:hover {
    background: #f8fafc;
    border-color: #94a3b8;
  }

  .btn-danger {
    padding: 10px 20px;
    background: #dc2626;
    color: white;
    border: none;
    border-radius: 8px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
    box-shadow: 0 4px 6px -1px rgba(220, 38, 38, 0.2);
  }

  .btn-danger:hover {
    background: #b91c1c;
    transform: translateY(-1px);
  }

  /* Pagination Top Border */
  .pagination-container {
    border-top: 1px solid #e2e8f0;
    padding: 16px 24px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: #f8fafc;
    /* Subtle contrast footer */
  }

  /* Fixed height pagination buttons */
  .pagination-btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    height: 32px;
    min-width: 32px;
    padding: 0 12px;
    font-size: 13px;
    font-weight: 500;
    border-radius: 6px;
    text-decoration: none;
    transition: all 0.2s;
    border: 1px solid transparent;
    line-height: 1;
  }

  .pagination-btn.active {
    background: #3b82f6;
    color: white;
    border-color: #3b82f6;
  }

  .pagination-btn.neutral {
    background: white;
    border-color: #cbd5e1;
    color: #475569;
  }

  .pagination-btn.neutral:hover {
    border-color: #94a3b8;
    color: #0f172a;
    background: #f8fafc;
  }
</style>
{% endblock %}

{% block content %}
<div class="product-catalog">

  <!-- Header -->
  <div class="catalog-header">
    <div class="catalog-title">
      <h1>Product Catalog</h1>
      <p>Manage inventory, variants, and pricing.</p>
    </div>
    <div class="compact-mode">
      <span>Compact Mode</span>
      <div style="width: 12px;"></div>
      <div class="toggle-switch" onclick="this.classList.toggle('active')"></div>
    </div>
  </div>

  <!-- Tools Bar -->
  <div class="filter-bar">
    <div class="catalog-search-wrapper" style="width: 280px; position: relative;">
      <i class="fa fa-search catalog-search-icon"></i>
      <input type="text" class="catalog-search-input" id="instantSearch" placeholder="Filter by SKU, name..."
        value="{{ request.GET.search }}" style="padding-left: 40px; height: 36px; font-size: 13px;"
        hx-get="{% url 'marketing:product_list' %}" hx-trigger="keyup changed delay:300ms, search"
        hx-target="#product-table-body" hx-indicator="#search-loader" name="search">
      <div id="search-loader" class="htmx-indicator"
        style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%);">
        <i class="fa fa-spinner fa-spin" style="color: #94a3b8; font-size: 14px;"></i>
      </div>
    </div>

    <div class="actions-right">
      <!-- Bulk Actions (Hidden by default) -->
      <div id="bulkActions"
        style="display: none; align-items: center; gap: 12px; margin-right: 12px; animation: fadeIn 0.2s;">
        <span style="font-size: 13px; color: #64748b; font-weight: 500;">
          <span id="selectedCount">0</span> selected
        </span>
        <button class="btn-danger" style="padding: 10px 16px; font-size: 13px;" onclick="openBulkDeleteModal()">
          <i class="fa fa-trash"></i> Delete
        </button>
      </div>

      <button class="filter-btn" onclick="document.getElementById('csvModal').classList.add('show')">
        <i class="fa fa-download"></i> Export
      </button>
      <!-- Moved to right side --> <a href="{% url 'marketing:product_create' %}" class="btn-primary">
        <i class="fa fa-plus"></i> Product
      </a>
    </div>
  </div>

  <!-- Data Table Card -->
  <div class="table-card">
    <form id="bulkForm">
      <table class="product-table">
        <thead>
          <tr>
            <th style="width: 48px;">
              <div class="custom-checkbox" onclick="toggleAllCheckboxes(this)"></div>
            </th>
            <th style="width: 72px;">IMAGE</th>
            <th>PRODUCT NAME</th>
            <th>SKU</th>
            <th>CATEGORY</th>
            <th>ATTRIBUTES</th>
            <th style="text-align: center;">STOCK</th>
            <th>PRICE</th>
            <th>STATUS</th>
            <th style="width: 48px;"></th>
          </tr>
        </thead>
        <tbody id="product-table-body">
          {% include "marketing/partials/product_list_rows.html" %}
        </tbody>
      </table>
    </form>


    <!-- Pagination -->
    {% if is_paginated %}
    <div class="pagination-container">
      <div style="font-size: 13px; color: #64748b;">
        Showing <span style="font-weight: 600; color: #0f172a;">{{ page_obj.start_index }}-{{page_obj.end_index}}</span>
        of {{ paginator.count }} products
      </div>
      <div style="display: flex; gap: 6px;">
        {% if page_obj.has_previous %}
        <a href="?page={{ page_obj.previous_page_number }}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}"
          class="pagination-btn neutral">Previous</a>
        {% endif %}

        {% for num in page_obj.paginator.page_range %}
        {% if page_obj.number == num %}
        <span class="pagination-btn active">{{ num }}</span>
        {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %} <a
          href="?page={{ num }}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}"
          class="pagination-btn neutral">{{ num }}</a>
          {% endif %}
          {% endfor %}

          {% if page_obj.has_next %}
          <a href="?page={{ page_obj.next_page_number }}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}"
            class="pagination-btn neutral">Next</a>
          {% endif %}
      </div>
    </div>
    {% endif %}
  </div>
</div>

<!-- Delete Modal -->
<div class="modal-backdrop" id="deleteModal">
  <div class="modal-card">
    <div class="modal-icon danger"><i class="fa fa-exclamation-triangle"></i></div>
    <h3 class="modal-title">Delete Product</h3>
    <p class="modal-desc">Are you sure you want to delete <strong id="delProdName"></strong>? This action cannot be
      undone.</p>
    <div class="modal-actions">
      <button class="btn-secondary"
        onclick="document.getElementById('deleteModal').classList.remove('show')">Cancel</button>
      <button class="btn-danger" onclick="confirmDelete()">Delete Product</button>
    </div>
  </div>
</div>

<!-- CSV Modal -->
<div class="modal-backdrop" id="csvModal">
  <div class="modal-card">
    <div class="modal-icon info" style="background: #3b82f6; color: white;">
      <i class="fas fa-sync-alt"></i>
    </div>
    <h3 class="modal-title">Bulk Stock Update</h3>
    <p class="modal-desc">Upload a CSV file to update variant stock quantities</p>

    <div
      style="border: 2px dashed #cbd5e1; border-radius: 12px; padding: 32px; margin-bottom: 24px; background: #f8fafc; text-align: center;">
      <div
        style="width: 48px; height: 48px; background: #e2e8f0; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 16px; color: #64748b;">
        <i class="fas fa-cloud-upload-alt"></i>
      </div>
      <p style="font-size: 14px; color: #64748b; margin-bottom: 16px;">Drag and drop your CSV file or</p>
      <label for="csvFile"
        style="display: inline-block; padding: 8px 16px; background: white; border: 1px solid #3b82f6; color: #3b82f6; border-radius: 6px; font-weight: 600; font-size: 13px; cursor: pointer; transition: all 0.2s;">
        Choose File
      </label>
      <input type="file" id="csvFile" style="display: none;"
        onchange="this.previousElementSibling.textContent = this.files[0].name">
      <p style="font-size: 12px; color: #94a3b8; margin-top: 16px;">Required columns: Kodu (SKU), Miktar (Quantity)</p>
    </div>

    <div class="modal-actions" style="justify-content: space-between; align-items: center;">
      <button class="btn-secondary" style="border: none; color: #0f172a; font-weight: 600;"
        onclick="document.getElementById('csvModal').classList.remove('show')">Cancel</button>
      <button class="btn-primary"
        style="background: #e2e8f0; color: #94a3b8; border: none; box-shadow: none; padding: 10px 20px; border-radius: 6px; font-weight: 600; display: flex; align-items: center; gap: 8px;"
        onclick="alert('Upload functionality to be implemented')">
        <i class="fas fa-upload"></i> Upload & Update
      </button>
    </div>
  </div>
</div>

</div>

<!-- Bulk Delete Modal -->
<div class="modal-backdrop" id="bulkDeleteModal">
  <div class="modal-card">
    <div class="modal-icon danger"><i class="fa fa-exclamation-triangle"></i></div>
    <h3 class="modal-title">Delete Products</h3>
    <p class="modal-desc">
      Are you sure you want to delete <strong id="bulkDelCount">0</strong> selected products?
      This action cannot be undone.
    </p>
    <div class="modal-actions">
      <button class="btn-secondary" onclick="document.getElementById('bulkDeleteModal').classList.remove('show')">
        Cancel
      </button>
      <button class="btn-danger" hx-post="{% url 'marketing:product_bulk_delete' %}" hx-trigger="click"
        hx-include="#bulkForm input[name='product_ids']:checked" hx-target="body">
        Yes, Delete All
      </button>
    </div>
  </div>
</div>

<script>
  // Toggle Variants
  function toggleVariants(pid, tr, event) {
    // If event is provided (row click), check source
    if (event) {
      const target = event.target;
      // Ignore clicks on interactive elements
      if (target.closest('a') ||
        target.closest('button') ||
        target.closest('input') ||
        target.closest('.custom-checkbox')) {
        return;
      }
    }

    tr.classList.toggle('expanded');
    const variantRow = document.getElementById('variants-' + pid);
    if (variantRow) {
      variantRow.classList.toggle('show');

      // Trigger lazy load if expanding
      if (variantRow.classList.contains('show')) {
        const box = variantRow.querySelector('.variant-box');
        // Trigger HTMX if found
        if (box && typeof htmx !== 'undefined') {
          htmx.trigger(box, 'variant-load');
        }
      }
    }

    // Rotate chevron if present
    const chevron = tr.querySelector('.btn-expand i');
    if (chevron && tr.classList.contains('expanded')) {
      chevron.style.transform = 'rotate(90deg)';
    } else if (chevron) {
      chevron.style.transform = '';
    }
  }

  // Bulk Selection Logic
  function toggleAllCheckboxes(headerCheckbox) {
    const isChecked = !headerCheckbox.classList.contains('active');

    if (isChecked) {
      headerCheckbox.classList.add('active');
      headerCheckbox.style.backgroundColor = '#3b82f6';
      headerCheckbox.style.borderColor = '#3b82f6';
      headerCheckbox.innerHTML = '<i class="fa fa-check" style="color: white; font-size: 12px; display: block; text-align: center; line-height: 18px;"></i>';
    } else {
      headerCheckbox.classList.remove('active');
      headerCheckbox.style.backgroundColor = '';
      headerCheckbox.style.borderColor = '';
      headerCheckbox.innerHTML = '';
    }

    const checkboxes = document.querySelectorAll('.row-checkbox');
    checkboxes.forEach(cb => {
      const input = cb.querySelector('input');
      input.checked = isChecked;
      updateCheckboxVisual(cb, isChecked);
    });
    updateBulkActions();
  }

  // Row Checkbox Handling - Inline Function
  function toggleRowCheckbox(checkboxDiv, event) {
    if (event) {
      event.preventDefault(); // Prevent default browser behavior
      event.stopPropagation(); // Stop bubbling
    }

    // Determine new state based on current VISUAL state (source of truth for user)
    const isActive = checkboxDiv.classList.contains('active');
    const newState = !isActive;

    const input = checkboxDiv.querySelector('input');
    input.checked = newState; // Force input to match desired state

    updateCheckboxVisual(checkboxDiv, newState);
    updateBulkActions();
  }

  function updateCheckboxVisual(container, isChecked) {
    let icon = container.querySelector('i.fa-check');

    if (isChecked) {
      container.classList.add('active');
      container.style.backgroundColor = '#3b82f6';
      container.style.borderColor = '#3b82f6';
      if (!icon) {
        // Add icon if not present
        const i = document.createElement('i');
        i.className = 'fa fa-check';
        i.style.cssText = 'color: white; font-size: 12px; display: block; text-align: center; line-height: 18px; pointer-events: none;';
        container.appendChild(i);
      }
    } else {
      container.classList.remove('active');
      container.style.backgroundColor = '';
      container.style.borderColor = '';
      if (icon) {
        icon.remove();
      }
    }
  }

  function updateBulkActions() {
    const selected = document.querySelectorAll('input[name="product_ids"]:checked').length;
    const bulkActions = document.getElementById('bulkActions');
    const searchWrapper = document.querySelector('.catalog-search-wrapper');

    if (selected > 0) {
      bulkActions.style.display = 'flex';
      document.getElementById('selectedCount').textContent = selected;
    } else {
      bulkActions.style.display = 'none';
      searchWrapper.style.display = 'block';
    }
  }

  function openBulkDeleteModal() {
    const selected = document.querySelectorAll('input[name="product_ids"]:checked').length;
    if (selected === 0) return;
    document.getElementById('bulkDelCount').textContent = selected;
    document.getElementById('bulkDeleteModal').classList.add('show');
  }

  // Global Modal Close on ESC
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') {
      document.querySelectorAll('.modal-backdrop').forEach(el => el.classList.remove('show'));
    }
  });
</script>
{% endblock content %}